import{r as I,t as R,m as L,f as F,o as G,n as H,_ as J,g as v,a as h,c as K,h as u,w as r,e as m,l as E,q as O,s as D,v as Q}from"./index-02e2295c.js";function p(f){let o=f.offsetLeft,l=f.offsetParent,n;for(;l!==null;)o+=l.offsetLeft,l=l.offsetParent;return n=document.body.scrollLeft+document.documentElement.scrollLeft,o-n}const Y={name:"auido-player",props:{musicList:{type:Array,default:[],required:!0}},setup(f){const o=I(null),l=I(null),{musicList:n}=R(f),w=L(()=>n.value.length>0?n.value[e.curIndex]:{}),x=t=>{e.curIndex=t,P()},e=F({duration:1,loadedTime:0,playedTime:0,isPlaying:!1,isLoading:!1,audioPlayPromise:Promise.resolve(),rejectPlayPromise:null,curIndex:0}),c=()=>{const t=o.value.play();if(t)return e.audioPlayPromise=new Promise((s,a)=>{e.rejectPlayPromise=a,t.then(i=>{e.rejectPlayPromise=null,e.isPlaying=!0,s(i)}).catch(i=>{console.log(i),e.isPlaying=!1,e.isLoading=!1})})},d=()=>{e.audioPlayPromise.then(()=>{o.value.pause(),e.isPlaying=!1,e.isLoading=!1}).catch(()=>{o.value.pause(),e.isPlaying=!1,e.isLoading=!1}),e.rejectPlayPromise&&(e.rejectPlayPromise(),e.rejectPlayPromise=null)},T=t=>{o.value.currentTime=t},g=()=>{e.duration=o.value.duration},_=()=>{console.log("onAudioProgress........"),o.value.buffered.length?e.loadedTime=o.value.buffered.end(o.value.buffered.length-1):e.loadedTime=0},y=()=>{e.playedTime=o.value.currentTime},S=()=>{console.log("onAudioEnded........"),e.isPlaying=!1,e.isLoading=!1,A()},V=()=>{console.log("onAudioWaiting... isLoading"),e.isLoading=!0},j=()=>{e.isLoading=!1},X=()=>{console.log(o.value),o.value.addEventListener("durationchange",g),o.value.addEventListener("progress",_),o.value.addEventListener("timeupdate",y),o.value.addEventListener("ended",S),o.value.addEventListener("waiting",V),o.value.addEventListener("canplay",j)};G(()=>{X()});const z=L(()=>e.loadedTime/e.duration),U=L(()=>e.playedTime/e.duration),B=t=>{console.log(l);const s=l.value.clientWidth;(t.clientX-p(l.value))/s,document.addEventListener("mousemove",b),document.addEventListener("mouseup",k)},b=t=>{const s=l.value.clientWidth;let a=(t.clientX-p(l.value))/s;a=a>0?a:0,a=a<1?a:1,d(),e.playedTime=a*e.duration,console.log("duration:"+e.duration+",mouseMove:"+e.playedTime),o.value.currentTime=e.playedTime},k=t=>{document.removeEventListener("mouseup",k),document.removeEventListener("mousemove",b);const s=l.value.clientWidth;let a=(t.clientX-p(l.value))/s;a=a>0?a:0,a=a<1?a:1,e.playedTime=a*e.duration,console.log("duration:"+e.duration+",mouseMove:"+e.playedTime),e.playedTime==o.value.duration?(console.log("onDocumentMouseUp pause........."),d(),o.value.currentTime=e.playedTime):(console.log("onDocumentMouseUp play........."),o.value.currentTime=e.playedTime,c())},N=t=>{const s=l.value.clientWidth;(t.clientX-p(l.value))/s,document.addEventListener("touchmove",M),document.addEventListener("touchend",W)},M=t=>{const s=t.changedTouches[0],a=l.value.clientWidth;let i=(s.clientX-p(l.value))/a;i=i>0?i:0,i=i<1?i:1,d(),e.playedTime=i*e.duration,console.log("duration:"+e.duration+",mouseMove:"+e.playedTime),o.value.currentTime=e.playedTime},W=t=>{document.removeEventListener("touchend",W),document.removeEventListener("touchmove",M);const s=t.changedTouches[0],a=l.value.clientWidth;let i=(s.clientX-p(l.value))/a;i=i>0?i:0,i=i<1?i:1,e.playedTime=i*e.duration,console.log("duration:"+e.duration+",mouseMove:"+e.playedTime),o.value.currentTime=e.playedTime,o.value.playedTime==o.value.duration?d():c()},P=()=>{H(()=>{c()})},C=t=>{let s=n.value.length-1;t=="prev"&&(e.curIndex<=0?e.curIndex=s-1:e.curIndex--),t=="next"&&(e.curIndex>=s?e.curIndex=0:e.curIndex++)},q=()=>{C("prev"),e.duration=0,e.playedTime=0,e.loadedTime=0,e.isPlaying=!1,P()},A=()=>{C("next"),e.duration=0,e.playedTime=0,e.loadedTime=0,e.isPlaying=!1,P()};return{audioEL:o,barWrapEL:l,playStat:e,play:c,pause:d,setCurrentTime:T,loadProgress:z,playProgress:U,onThumbMouseDown:B,onThumbTouchStart:N,prev:q,next:A,currentMusic:w,changeIndex:x}}};const Z={class:"audio-wrapper"},$={class:"a-wrapper"},ee={class:"a-bar",ref:"barWrapEL"},oe=["src"];function ne(f,o,l,n,w,x){const e=v("svg-icon"),c=v("el-icon"),d=v("VideoPause"),T=v("VideoPlay"),g=v("el-col"),_=v("el-row");return h(),K("div",Z,[u(_,{class:"audio-wrapper-order"},{default:r(()=>[u(g,{span:3},{default:r(()=>[u(c,{size:40,color:"white",onClick:n.prev},{default:r(()=>[u(e,{name:"skip"})]),_:1},8,["onClick"]),n.playStat.isPlaying?(h(),E(c,{key:0,size:40,color:"white",onClick:n.pause},{default:r(()=>[u(d)]),_:1},8,["onClick"])):(h(),E(c,{key:1,size:40,color:"white",onClick:n.play},{default:r(()=>[u(T)]),_:1},8,["onClick"])),u(c,{size:40,color:"white",onClick:n.next},{default:r(()=>[u(e,{name:"skip",class:"svg-icon-skip"})]),_:1},8,["onClick"])]),_:1}),u(g,{span:12},{default:r(()=>[m("div",$,[m("div",null,O(n.currentMusic.musicName),1),m("div",ee,[m("div",{class:"a-loaded",style:D({width:`${n.loadProgress*100}%`})},null,4),m("div",{class:"a-played",style:D({width:`${n.playProgress*100}%`})},[m("span",{class:"a-thumb",onMousedown:o[0]||(o[0]=(...y)=>n.onThumbMouseDown&&n.onThumbMouseDown(...y)),onTouchstart:o[1]||(o[1]=(...y)=>n.onThumbTouchStart&&n.onThumbTouchStart(...y))},[n.playStat.isLoading?(h(),E(e,{key:0,name:"loading",class:"a-loading-icon"})):Q("",!0)],32)],4)],512)])]),_:1})]),_:1}),m("audio",{src:n.currentMusic.audioUrl,ref:"audioEL"},null,8,oe)])}const ae=J(Y,[["render",ne],["__scopeId","data-v-81f1c816"]]);export{ae as default};
